<!DOCTYPE html>  <html> <head>   <title>filtercollection.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               filtercollection.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Collection = </span><span class="nx">require</span> <span class="s">&quot;collections/collection&quot;</span>
<span class="nv">application = </span><span class="nx">require</span> <span class="s">&#39;application&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>FramelistFrameView = require './framelistframe_view'
context = require '../models/core/context'</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Simple</span> <span class="nv">Query:</span>
<span class="s">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s">&quot;logic&quot;</span><span class="o">:</span><span class="s">&quot;and&quot;</span><span class="p">,</span><span class="s">&quot;criteria&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="s">&quot;eq&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;results.state&quot;</span><span class="p">}]}</span>

<span class="nx">Logical</span> <span class="nv">Query:</span>
<span class="s">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s">&quot;logic&quot;</span><span class="o">:</span><span class="s">&quot;and&quot;</span><span class="p">,</span><span class="s">&quot;criteria&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="s">&quot;eq&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;results.state&quot;</span><span class="p">,</span><span class="s">&quot;logic&quot;</span><span class="o">:</span><span class="s">&quot;and&quot;</span><span class="p">,</span><span class="s">&quot;criteria&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="s">&quot;eq&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;results.state&quot;</span><span class="p">}]}]}</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>groupfns: list, first, last, max, min, avg, sum</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">module.exports = </span><span class="k">class</span> <span class="nx">FilterCollection</span> <span class="k">extends</span> <span class="nx">Collection</span>
  <span class="nv">_defaults:</span>
    <span class="nx">sortkey</span><span class="o">:</span><span class="kc">false</span>
    <span class="nx">sortorder</span><span class="o">:-</span><span class="mi">1</span>
    <span class="nx">sorttype</span><span class="o">:</span><span class="kc">false</span>
    <span class="nx">skip</span><span class="o">:</span><span class="mi">0</span>
    <span class="nx">limit</span><span class="o">:</span><span class="mi">20</span>
    <span class="nx">query</span><span class="o">:</span><span class="p">{}</span>
    <span class="nx">groupby</span><span class="o">:</span><span class="kc">false</span>
    <span class="nx">groupfns</span><span class="o">:</span><span class="p">{}</span>
  <span class="nx">url</span><span class="o">:</span><span class="s">&quot;/getFrames&quot;</span>
  <span class="nx">subscribePath</span><span class="o">:</span><span class="s">&quot;frame&quot;</span>
  <span class="nx">mute</span><span class="o">:</span><span class="kc">false</span>
  <span class="nx">clearOnFetch</span><span class="o">:</span><span class="kc">true</span>
  
  
  <span class="nv">initialize: </span><span class="nf">(models,params) =&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>if params.context?
@context = new context({name:params.context})
@context.fetch()
 success: () =>
   for menuItem of @context.get('menuItems')
     f = 1</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Create callback stack for functions to be called before and after a fetch</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@callbackStack = </span><span class="p">{}</span>
    <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The mute param: use if filter collection is a parent and does not contain data</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">mute</span><span class="o">?</span>
      <span class="vi">@mute = </span><span class="nx">params</span><span class="p">.</span><span class="nx">mute</span>
    </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The clearOnFetch param:
true: (default) clears collection on fetch.
false: retains data in collection (for pagination)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">clearOnFetch</span><span class="o">?</span>
      <span class="vi">@clearOnFetch = </span><span class="nx">params</span><span class="p">.</span><span class="nx">clearOnFetch</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>init bound collections in private space</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@_boundCollections = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>init sort params in private space</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@_sortParams = </span><span class="nx">_</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">@_defaults</span>

    <span class="k">super</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span><span class="nx">params</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>bindFilter:</h3>

<p>An instance of FilterCollection that when changed, bubbles the filter
  up through all bound filters.
  example:</p>

<blockquote>
  <p>Creating a FilterCollection with mute on, then creating
  5 other FilterCollections bound to the initial instance.
  when you change the initial FilterCollection, all others
  refresh with filter settings</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">bindFilter</span>
      <span class="nx">params</span><span class="p">.</span><span class="nx">bindFilter</span><span class="p">.</span><span class="nx">subCollection</span> <span class="nx">@</span>
      <span class="vi">@bindFilter = </span><span class="nx">params</span><span class="p">.</span><span class="nx">bindFilter</span>
      <span class="nx">@bindFilter</span>
      <span class="vi">@_sortParams = </span><span class="nx">@bindFilter</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="vi">@bindFilter = </span><span class="kc">false</span>
    </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Set baseUrl off of default url.  url is changed, baseUrl remains root url</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="o">?</span>
      <span class="vi">@url = </span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span>
    <span class="vi">@baseUrl = </span><span class="nx">@url</span>
    </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Load filter widgets
TODO: make these collections</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">!</span><span class="nx">@filters</span><span class="o">?</span>
      <span class="vi">@filters = </span><span class="p">[]</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">application</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ui_filters_framemetadata</span><span class="o">?</span>
      <span class="nv">application.settings.ui_filters_framemetadata = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Render filter widgets</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">view</span>
      <span class="vi">@view = </span><span class="nx">params</span><span class="p">.</span><span class="nx">view</span>
      <span class="nv">i = </span><span class="mi">0</span>
      <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">application</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">ui_filters_framemetadata</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>@filters.push @view.addSubview o.type+"<em>"+o.field</em>name, @loadFilter(o.format), '#filter<em>form', {params:o,collection:@,append:"filter</em>" + i}</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Add sub collection</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">subCollection: </span><span class="nf">(collection) =&gt;</span>
    <span class="nx">@_boundCollections</span><span class="p">.</span><span class="nx">push</span> <span class="nx">collection</span>

  <span class="nv">subscribe: </span><span class="nf">(channel,callback=@receive) =&gt;</span>
    <span class="k">if</span> <span class="nx">channel</span><span class="o">?</span>
      <span class="k">if</span> <span class="nx">@name</span>
        <span class="nv">namePath = </span><span class="nx">@name</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span>
      <span class="k">else</span>
        <span class="nv">namePath = </span><span class="s">&#39;&#39;</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">removeListener</span> <span class="s">&quot;message:</span><span class="si">#{</span><span class="nx">@subscribePath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">namePath</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">callback</span>
      <span class="vi">@name = </span><span class="nx">channel</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>if application.debug
console.info "series:  subscribing to channel "+"message:#{@subscribePath}/#{namePath}"</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">application</span><span class="p">.</span><span class="nx">socket</span>
      <span class="nx">application</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span> <span class="s">&quot;message:</span><span class="si">#{</span><span class="nx">@subscribePath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">namePath</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">callback</span>
      <span class="k">if</span> <span class="o">!</span><span class="nx">application</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@subscribePath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">namePath</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span>
        <span class="nx">application</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">[</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@subscribePath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">namePath</span><span class="si">}</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">application</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span> <span class="s">&#39;subscribe&#39;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@subscribePath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">namePath</span><span class="si">}</span><span class="s">&quot;</span>

  <span class="nv">receive: </span><span class="nf">(data) =&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">data</span>
    </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Set sort param.  Bubble up through bound FiltersCollections</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setParam: </span><span class="nf">(key,val) =&gt;</span>
    <span class="k">if</span> <span class="nx">key</span> <span class="o">!=</span> <span class="s">&quot;skip&quot;</span>
      <span class="nx">@resetParam</span><span class="p">(</span><span class="s">&quot;skip&quot;</span><span class="p">)</span> 
    <span class="nx">@_sortParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@_boundCollections</span>
      <span class="nx">o</span><span class="p">.</span><span class="nx">setParam</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Reset sort param.  Do not Bubble up through bound FiltersCollections</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resetParam: </span><span class="nf">(key) =&gt;</span>
    <span class="k">if</span> <span class="nx">@_defaults</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span>
      <span class="nx">@_sortParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@_defaults</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="k">return</span> <span class="nx">@_sortParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Get sort param, or return val</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">getParam</span><span class="o">:</span><span class="nf">(key,val) =&gt;</span>
    <span class="k">if</span> <span class="nx">@_sortParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@_sortParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">false</span>
      <span class="k">return</span> <span class="nx">@_sortParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">val</span><span class="o">?</span>
      <span class="k">return</span> <span class="nx">val</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@_defaults</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span>
      <span class="k">return</span> <span class="nx">@_defaults</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Get filter library from application</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">loadFilter: </span><span class="nf">(name) -&gt;</span>
    <span class="nx">application</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Get bound filters and mix-in bound FilterCollection filters</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getFilters: </span><span class="p">()</span> <span class="o">=&gt;</span>
    <span class="nv">_filters = </span><span class="nx">@filters</span>
    <span class="k">if</span> <span class="nx">@bindFilter</span>
      <span class="nv">_filters = </span><span class="nx">_filters</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">@bindFilter</span><span class="p">.</span><span class="nx">getFilters</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">_filters</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Sort collection</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sortList: </span><span class="nf">(sorttype, sortkey, sortorder) =&gt;</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@getFilters</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">o</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">field_name</span> <span class="o">==</span> <span class="nx">sortkey</span>
        <span class="nx">@setParam</span><span class="p">(</span><span class="s">&#39;sortkey&#39;</span><span class="p">,</span> <span class="nx">sortkey</span><span class="p">)</span>
        <span class="nx">@setParam</span><span class="p">(</span><span class="s">&#39;sortorder&#39;</span><span class="p">,</span> <span class="nx">sortorder</span><span class="p">)</span>
        <span class="nx">@setParam</span><span class="p">(</span><span class="s">&#39;sorttype&#39;</span><span class="p">,</span> <span class="nx">sorttype</span><span class="p">)</span>
    <span class="k">return</span>
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Sync filters
"query":{"logic":"and","criteria":[{"type":"left","eq":1,"name":"results.state"}]}</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h1>#</h1>

<p>select * where datetime = 123456789 and (results.left.state = 1 or results.right.state = 1) </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span>
      <span class="s">&quot;logic&quot;</span><span class="o">:</span><span class="s">&quot;and&quot;</span><span class="p">,</span>
      <span class="s">&quot;criteria&quot;</span><span class="o">:</span><span class="p">[</span>
        <span class="p">{</span>
          <span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;frame&quot;</span><span class="p">,</span>
          <span class="s">&quot;eq&quot;</span><span class="o">:</span><span class="mi">123456789</span><span class="p">,</span>
          <span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;dt&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s">&quot;logic&quot;</span><span class="o">:</span><span class="s">&quot;or&quot;</span><span class="p">,</span>
          <span class="s">&quot;criteria&quot;</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span>          
              <span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;left&quot;</span><span class="p">,</span>
              <span class="s">&quot;eq&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
              <span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;results.state&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>          
              <span class="s">&quot;type&quot;</span><span class="o">:</span><span class="s">&quot;right&quot;</span><span class="p">,</span>
              <span class="s">&quot;eq&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
              <span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;results.state&quot;</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">alterFilters</span><span class="o">:</span><span class="p">()</span> <span class="o">=&gt;</span>
    <span class="nv">criteria = </span><span class="p">[]</span>
    <span class="nv">_json = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@filters</span>
      <span class="nv">val = </span><span class="nx">o</span><span class="p">.</span><span class="nx">toJson</span><span class="p">()</span>
      <span class="k">if</span> <span class="nx">val</span>
        <span class="nx">criteria</span><span class="p">.</span><span class="nx">push</span> <span class="nx">val</span>
    <span class="k">if</span> <span class="nx">criteria</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">_json = </span><span class="p">{</span><span class="nx">logic</span><span class="o">:</span><span class="s">&#39;and&#39;</span><span class="p">,</span><span class="nx">criteria</span><span class="o">:</span><span class="nx">criteria</span><span class="p">}</span>
    <span class="nx">@setParam</span> <span class="s">&#39;query&#39;</span><span class="p">,</span> <span class="nx">_json</span>
    <span class="k">return</span>
  
  <span class="nv">getSettings: </span><span class="nf">(total=false, addParams) =&gt;</span>
    <span class="k">if</span> <span class="nx">total</span>
      <span class="nv">skip = </span><span class="mi">0</span>
      <span class="nv">limit = </span><span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;skip&#39;</span><span class="p">)</span><span class="o">+</span><span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;limit&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">skip</span><span class="o">=</span><span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;skip&#39;</span><span class="p">)</span>
      <span class="nx">limit</span><span class="o">=</span><span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;limit&#39;</span><span class="p">)</span>
    <span class="nv">_json =</span>
      <span class="nx">skip</span><span class="o">:</span><span class="nx">skip</span>
      <span class="nx">limit</span><span class="o">:</span><span class="nx">limit</span>
      <span class="nv">query: </span><span class="nx">@getParam</span> <span class="s">&#39;query&#39;</span>
      <span class="nv">sortinfo:</span>
        <span class="nv">type: </span><span class="nx">@getParam</span> <span class="s">&#39;sorttype&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
        <span class="nv">name: </span><span class="nx">@getParam</span> <span class="s">&#39;sortkey&#39;</span><span class="p">,</span> <span class="s">&#39;capturetime_epoch&#39;</span>
        <span class="nv">order: </span><span class="nx">@getParam</span> <span class="s">&#39;sortorder&#39;</span>
        
    <span class="k">if</span> <span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;groupby&#39;</span><span class="p">)</span>
      <span class="nx">_json</span><span class="p">[</span><span class="s">&#39;groupByField&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nv">groupby: </span><span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;groupby&#39;</span><span class="p">),</span> <span class="nv">groupfns: </span><span class="nx">@getParam</span><span class="p">(</span><span class="s">&#39;groupfns&#39;</span><span class="p">)}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>if groupByField
 _json['groupByField'] = groupByField</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">addParams</span>
      <span class="nv">_json = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">_json</span><span class="p">,</span> <span class="nx">addParams</span>
    <span class="k">return</span> <span class="nx">_json</span>
    
  <span class="nv">getUrl: </span><span class="nf">(total=false, addParams, dataSet=false)=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>todo: map .error to params.error
if @bindFilter
 dataSet = @bindFilter.getSettings(total, addParams)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">!</span><span class="nx">dataSet</span>
      <span class="nv">dataSet = </span><span class="nx">@getSettings</span><span class="p">(</span><span class="nx">total</span><span class="p">,</span> <span class="nx">addParams</span><span class="p">)</span>
    <span class="s">&quot;/&quot;</span><span class="o">+</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">dataSet</span>

  <span class="nx">preFetch</span><span class="o">:</span><span class="p">()</span><span class="o">=&gt;</span>
    <span class="nx">application</span><span class="p">.</span><span class="nx">modal</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">@clearOnFetch</span>
      <span class="vi">@_all = </span><span class="nx">@models</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;pre&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">==</span> <span class="s">&#39;function&#39;</span>
        <span class="nx">o</span><span class="p">()</span>
    <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;pre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span>
  
  <span class="nx">postFetch</span><span class="o">:</span><span class="p">()</span><span class="o">=&gt;</span>
    <span class="nx">application</span><span class="p">.</span><span class="nx">modal</span><span class="p">.</span><span class="nx">onSuccess</span><span class="p">()</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">@clearOnFetch</span>
      <span class="nx">@add</span> <span class="nx">@_all</span><span class="p">,</span> <span class="p">{</span><span class="nv">silent: </span><span class="kc">true</span><span class="p">}</span>
      <span class="vi">@_all = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">i</span><span class="p">,</span><span class="nx">o</span> <span class="k">of</span> <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;post&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">==</span> <span class="s">&#39;function&#39;</span>
        <span class="nx">o</span><span class="p">()</span>        
    <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;post&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span>

  <span class="nx">globalRefresh</span><span class="o">:=&gt;</span>
    <span class="nx">@fetch</span><span class="p">({</span><span class="nx">force</span><span class="o">:</span><span class="kc">true</span><span class="p">})</span>

  <span class="nv">setRaw: </span><span class="nf">(response) =&gt;</span>
    <span class="vi">@raw = </span><span class="nx">response</span>

  <span class="nv">fetch: </span><span class="nf">(params={}) =&gt;</span>
    <span class="nx">@preFetch</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">forceRefresh</span>
      <span class="vi">@models = </span><span class="p">[]</span>
    <span class="nv">total = </span><span class="nx">params</span><span class="p">.</span><span class="nx">total</span> <span class="o">||</span> <span class="kc">false</span>
    <span class="nv">_url = </span><span class="nx">@baseUrl</span><span class="o">+</span><span class="nx">@getUrl</span><span class="p">(</span><span class="nx">total</span><span class="p">,</span><span class="nx">params</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span><span class="o">||</span><span class="kc">false</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@_boundCollections</span>
      <span class="nx">o</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="o">!</span><span class="nx">@mute</span>
      <span class="vi">@_all = </span><span class="nx">@models</span>
      <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;pre&#39;</span><span class="p">].</span><span class="nx">push</span> <span class="nx">params</span><span class="p">.</span><span class="nx">before</span>
      <span class="nx">@callbackStack</span><span class="p">[</span><span class="s">&#39;post&#39;</span><span class="p">].</span><span class="nx">push</span> <span class="nx">params</span><span class="p">.</span><span class="nx">success</span>
      <span class="nv">params.success = </span><span class="nx">@postFetch</span>
      <span class="k">if</span> <span class="nx">@url</span> <span class="o">!=</span> <span class="nx">_url</span> <span class="o">or</span> <span class="nx">params</span><span class="p">.</span><span class="nx">force</span>
        <span class="vi">@url = </span><span class="nx">_url</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">params</span><span class="p">.</span><span class="nx">success</span>
        <span class="nx">params</span><span class="p">.</span><span class="nx">success</span><span class="p">()</span>
  
  <span class="nv">parse: </span><span class="nf">(response) =&gt;</span>
    <span class="vi">@totalavail = </span><span class="nx">response</span><span class="p">.</span><span class="nx">total_frames</span>
    <span class="vi">@lastavail = </span><span class="nx">response</span><span class="p">.</span><span class="nx">frames</span><span class="o">?</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="mi">0</span>
    <span class="nx">@setRaw</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">frames</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 